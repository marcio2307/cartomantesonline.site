<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Enviar Notifica√ß√£o - Cartomantes Online</title>

  <style>
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:#000;
      color:#fff;
      font-family:Arial, sans-serif;
      padding:20px;
    }
    .box{
      width:min(560px, 100%);
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.12);
      border-radius:16px;
      padding:18px;
      box-shadow:0 18px 50px rgba(0,0,0,0.55);
    }
    h1{ margin:0 0 12px; font-size:20px; }
    label{ display:block; font-size:13px; opacity:.9; margin:10px 0 6px; }
    input, textarea{
      width:100%;
      box-sizing:border-box;
      padding:12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.18);
      background:rgba(0,0,0,0.45);
      color:#fff;
      outline:none;
    }
    textarea{ min-height:90px; resize:vertical; }
    .row{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    @media (max-width:520px){ .row{ grid-template-columns:1fr; } }

    button{
      width:100%;
      margin-top:12px;
      height:52px;
      border:none;
      border-radius:14px;
      font-weight:800;
      letter-spacing:.6px;
      cursor:pointer;
      background:linear-gradient(180deg,#2ecc71 0%, #1f9b50 100%);
      color:#fff;
      box-shadow:0 16px 30px rgba(0,0,0,0.55);
    }
    button:disabled{
      opacity:.6;
      cursor:not-allowed;
    }
    .status{
      margin-top:12px;
      font-size:13px;
      opacity:.9;
      line-height:1.4;
      white-space:pre-line;
    }
    .mini{
      font-size:12px;
      opacity:.75;
      margin-top:10px;
    }
  </style>
</head>

<body>
  <div class="box">
    <h1>üîî Enviar Notifica√ß√£o (Cartomantes Online)</h1>

    <div class="row">
      <div>
        <label>T√≠tulo</label>
        <input id="titulo" value="Cartomantes Online" />
      </div>

      <div>
        <label>Link ao clicar (opcional)</label>
        <input id="link" value="./index.html" />
      </div>
    </div>

    <label>Mensagem</label>
    <textarea id="msg">Consultores dispon√≠veis agora. Toque para abrir.</textarea>

    <button id="btn">ENVIAR NOTIFICA√á√ÉO</button>

    <div class="status" id="status"></div>

    <div class="mini">
      √çcone/badge da notifica√ß√£o: <b>logo.png</b> (deve estar no mesmo diret√≥rio do PWA).
    </div>
  </div>

  <script>
    const statusEl = document.getElementById("status");
    const btn = document.getElementById("btn");

    function status(txt){
      statusEl.textContent = txt || "";
    }

    async function ensureSW(){
      if (!("serviceWorker" in navigator)) {
        throw new Error("Service Worker n√£o suportado neste navegador.");
      }

      // registra seu service-worker.js no mesmo n√≠vel do index.html
      const reg = await navigator.serviceWorker.register("./service-worker.js");
      await navigator.serviceWorker.ready;
      return reg;
    }

    async function ensurePermission(){
      if (!("Notification" in window)) {
        throw new Error("Notifica√ß√µes n√£o suportadas neste navegador.");
      }

      if (Notification.permission === "granted") return true;

      // precisa ser chamado por gesto do usu√°rio (clique)
      const perm = await Notification.requestPermission();
      if (perm !== "granted") {
        throw new Error("Permiss√£o de notifica√ß√£o negada.");
      }
      return true;
    }

    async function sendNotification(){
      btn.disabled = true;
      status("Preparando...");

      const titulo = document.getElementById("titulo").value.trim() || "Cartomantes Online";
      const msg = document.getElementById("msg").value.trim() || "Toque para abrir.";
      const link = document.getElementById("link").value.trim() || "./index.html";

      try{
        await ensurePermission();
        const reg = await ensureSW();

        // dispara via Service Worker (melhor estabilidade em PWA)
        await reg.showNotification(titulo, {
          body: msg,
          icon: "./logo.png",   // ‚úÖ nome do arquivo do √≠cone
          badge: "./logo.png",  // ‚úÖ nome do badge
          tag: "cartomantes-online",
          renotify: true,
          vibrate: [150, 100, 150],
          data: {
            url: link
          }
        });

        status("‚úÖ Notifica√ß√£o enviada!\nSe n√£o aparecer, verifique:\n- Permiss√£o do navegador\n- service-worker.js no mesmo diret√≥rio\n- arquivo logo.png existente");
      }catch(err){
        status("‚ùå Erro: " + (err?.message || err));
      }finally{
        btn.disabled = false;
      }
    }

    btn.addEventListener("click", sendNotification);

    // dica de status inicial
    (async () => {
      try{
        if ("Notification" in window){
          status("Permiss√£o atual: " + Notification.permission + "\nClique em ENVIAR NOTIFICA√á√ÉO para testar.");
        }else{
          status("Notifica√ß√µes n√£o suportadas neste navegador.");
          btn.disabled = true;
        }
      }catch{}
    })();
  </script>
</body>
</html>
