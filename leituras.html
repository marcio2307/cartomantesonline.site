<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Consultores Dispon√≠veis</title>

<!-- ‚úÖ PWA (GitHub Pages /cartomantesonline.site/) -->
<link rel="manifest" href="/cartomantesonline.site/manifest.json" />
<meta name="theme-color" content="#000000" />

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Poppins:wght@400;600;700;800;900&display=swap" rel="stylesheet" />

<style>
/* ======= SEU CSS INTEIRO (SEM ALTERAR) ======= */
:root{
  --gold-1:#fff0a6;
  --gold-2:#f6e27a;
  --gold-3:#c7a008;
  --gold-4:#b8860b;
  --black:#000000;
  --btn-h:56px;
  --btn-px:14px;
}
body{
  margin:0;
  min-height:100vh;
  background:
    radial-gradient(900px 420px at 15% 10%, rgba(199,160,8,0.20), rgba(0,0,0,0) 60%),
    radial-gradient(900px 420px at 85% 20%, rgba(199,160,8,0.16), rgba(0,0,0,0) 60%),
    radial-gradient(1200px 520px at 50% 120%, rgba(199,160,8,0.10), rgba(0,0,0,0) 65%),
    #000;
  font-family:'Poppins',sans-serif;
  color:#fff;
}
.banner-carousel{
  width:100%;
  margin:0;
  border-bottom:2px solid var(--gold-3);
  box-shadow:0 18px 60px rgba(0,0,0,0.55);
  position:relative;
  background:#000;
  overflow:hidden;
}
.banner-carousel::after{
  content:"";
  position:absolute;
  inset:0;
  background:
    radial-gradient(1200px 520px at 50% 15%, rgba(0,0,0,0.10), rgba(0,0,0,0.48) 60%),
    linear-gradient(180deg, rgba(0,0,0,0.02) 0%, rgba(0,0,0,0.35) 100%);
  pointer-events:none;
  z-index:3;
}
.banner-carousel .slide{
  position:absolute;
  inset:0;
  opacity:0;
  transition:opacity .45s ease;
  z-index:1;
}
.banner-carousel .slide.active{
  opacity:1;
  z-index:2;
}
.banner-carousel img{ width:100%; height:auto; display:block; }
.banner-carousel .spacer{ width:100%; pointer-events:none; }
.banner-carousel .spacer img{ opacity:0; visibility:hidden; }

@media (max-width:480px){
  .banner-carousel{ border-bottom-width:1px; }
  :root{ --btn-h:64px; --btn-px:16px; }
}
.page{ padding:22px 20px 28px; }
.hero{
  max-width:1200px;
  margin:0 auto 22px;
  text-align:center;
  padding:0 10px;
}
.hero h1{
  margin:0 0 10px;
  font-size:36px;
  font-weight:800;
  letter-spacing:0.2px;
  color:transparent;
  background-image: linear-gradient(180deg, var(--gold-2) 0%, var(--gold-3) 42%, var(--gold-1) 72%, var(--gold-4) 100%);
  -webkit-background-clip:text;
  background-clip:text;
  text-shadow:0 0 22px rgba(199,160,8,0.15);
}
.hero .vip-aviso{
  display:flex;
  justify-content:center;
  width:100%;
  margin:14px auto 0;
}
.hero .vip-aviso a{
  width:min(760px, 100%);
  min-height:66px;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  padding:16px 16px;
  border-radius:20px;
  text-decoration:none;
  font-weight:900;
  letter-spacing:.4px;
  line-height:1.25;
  color:#111;
  background:linear-gradient(180deg, var(--gold-1) 0%, var(--gold-2) 45%, var(--gold-3) 100%);
  border:1px solid rgba(255,255,255,0.18);
  box-shadow:
    0 22px 46px rgba(0,0,0,0.65),
    0 0 0 1px rgba(255,240,166,0.10) inset;
  text-transform:uppercase;
  -webkit-tap-highlight-color: transparent;
}
.hero .vip-aviso a:hover{ filter:brightness(1.05); }
.hero .vip-aviso a:active{ transform: translateY(1px); }
@media (max-width:480px){
  .hero .vip-aviso{ margin-top:12px; }
  .hero .vip-aviso a{
    width:100%;
    min-height:74px;
    padding:16px 14px;
    font-size:13px;
    letter-spacing:.35px;
    border-radius:18px;
  }
}
.container{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:20px;
  max-width:1200px;
  margin:0 auto;
}
@media (max-width:1024px){ .container{ grid-template-columns:repeat(3,1fr); } }
@media (max-width:768px){
  .container{ grid-template-columns:repeat(2,1fr); gap:15px; }
  .hero h1{ font-size:30px; }
}
@media (max-width:480px){
  .container{ grid-template-columns:repeat(2,1fr); gap:12px; }
  .hero h1{ font-size:26px; }
}
.card{
  position:relative;
  border-radius:18px;
  overflow:hidden;
  isolation:isolate;
  background:
    radial-gradient(560px 260px at 50% -10%, rgba(199,160,8,0.25), rgba(0,0,0,0) 60%),
    linear-gradient(180deg, rgba(18,18,18,0.86) 0%, rgba(5,5,5,0.98) 100%);
  border:1px solid rgba(199,160,8,0.55);
  box-shadow:
    0 18px 44px rgba(0,0,0,0.60),
    0 0 0 1px rgba(255,240,166,0.08) inset;
  transform:none !important;
  transition:none;
}
.card::before{
  content:"";
  position:absolute;
  inset:-2px;
  background:
    radial-gradient(520px 220px at 50% 0%, rgba(246,226,122,0.22), rgba(0,0,0,0) 60%),
    radial-gradient(180px 120px at 18% 18%, rgba(255,240,166,0.10), rgba(0,0,0,0) 70%),
    radial-gradient(180px 120px at 82% 28%, rgba(255,240,166,0.08), rgba(0,0,0,0) 70%);
  opacity:.9;
  pointer-events:none;
  z-index:0;
}
.card::after{
  content:"";
  position:absolute;
  inset:0;
  background:
    linear-gradient(120deg,
      rgba(255,240,166,0.00) 0%,
      rgba(255,240,166,0.04) 28%,
      rgba(255,240,166,0.00) 55%,
      rgba(255,240,166,0.00) 100%);
  mix-blend-mode:screen;
  opacity:.55;
  pointer-events:none;
  z-index:1;
}
.card:hover{
  border-color:rgba(246,226,122,0.95);
  box-shadow:
    0 18px 44px rgba(0,0,0,0.60),
    0 0 30px rgba(199,160,8,0.14),
    0 0 0 1px rgba(255,240,166,0.10) inset;
}
.card .img-wrap{ position:relative; z-index:2; padding:10px 10px 0; }
.card .img-wrap img{
  width:100%;
  height:240px;
  object-fit:cover;
  display:block;
  border-radius:14px;
  border:1px solid rgba(199,160,8,0.35);
  box-shadow:
    0 12px 30px rgba(0,0,0,0.55),
    0 0 0 1px rgba(255,240,166,0.06) inset;
  filter:saturate(1.06) contrast(1.06);
}
.card .img-wrap::after{
  content:"";
  position:absolute;
  left:10px; right:10px; bottom:0;
  height:86px;
  border-radius:0 0 14px 14px;
  background:linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.85) 100%);
  pointer-events:none;
}
.badge{
  position:absolute;
  top:16px; left:16px;
  padding:7px 11px;
  font-size:11px;
  border-radius:999px;
  text-transform:uppercase;
  color:#fff;
  font-weight:900;
  letter-spacing:0.6px;
  box-shadow:0 10px 18px rgba(0,0,0,0.50);
  z-index:4;
  border:1px solid rgba(255,255,255,0.18);
  background:linear-gradient(180deg, #2ecc71 0%, #1f9b50 100%);
}
.badge.ocupado{ background:linear-gradient(180deg, #f39c12 0%, #d35400 100%); }
.badge.indisp{ background:linear-gradient(180deg, #e74c3c 0%, #c0392b 100%); }
.content{ padding:12px 14px 16px; position:relative; z-index:3; }
.name{
  font-family:'Cinzel', serif;
  font-size:16px;
  font-weight:800;
  text-align:center;
  margin:6px 0 8px;
  display:flex;
  justify-content:center;
  align-items:center;
  gap:8px;
  color:transparent;
  background-image:linear-gradient(180deg, var(--gold-1) 0%, var(--gold-3) 52%, var(--gold-2) 100%);
  -webkit-background-clip:text;
  background-clip:text;
  text-shadow:0 0 18px rgba(199,160,8,0.12);
}
.dot{
  width:9px; height:9px;
  border-radius:50%;
  background:#2ecc71;
  animation:blink 1s infinite;
  box-shadow:0 0 12px rgba(46,204,113,0.40);
}
@keyframes blink{ 50%{ opacity:0; } }
.dot.ocupado{ background:#e67e22; animation:none; box-shadow:none; }
.dot.indisp{ background:#e74c3c; animation:none; box-shadow:none; }
.stars{
  color:transparent;
  background-image:linear-gradient(180deg, var(--gold-2) 0%, var(--gold-3) 55%, var(--gold-4) 100%);
  -webkit-background-clip:text;
  background-clip:text;
  text-align:center;
  margin-bottom:8px;
  font-size:14px;
  text-shadow:0 0 18px rgba(199,160,8,0.12);
}
.price{ text-align:center; font-size:13px; color:rgba(255,255,255,0.90); margin-bottom:12px; }
.price b{
  color:transparent;
  background-image:linear-gradient(180deg, var(--gold-2) 0%, var(--gold-3) 45%, var(--gold-1) 80%);
  -webkit-background-clip:text;
  background-clip:text;
}
.btn{
  width:100%;
  height:var(--btn-h);
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  padding:0 var(--btn-px);
  border-radius:16px;
  text-decoration:none;
  font-weight:900;
  font-size:13px;
  letter-spacing:0.7px;
  line-height:1.15;
  white-space:normal;
  overflow:visible;
  box-sizing:border-box;
  box-shadow: 0 16px 30px rgba(0,0,0,0.55), 0 0 0 1px rgba(255,240,166,0.06) inset;
  border:1px solid rgba(255,255,255,0.10);
  transition:filter .18s ease;
}
@media (max-width:480px){ .btn{ font-size:12px; } }
.btn.disponivel{ background:linear-gradient(180deg, #2ecc71 0%, #1f9b50 100%); color:#fff; border-color:rgba(255,255,255,0.16); }
.btn:hover{ filter:brightness(1.06); }
.btn.ocupado{ background:linear-gradient(180deg, #f39c12 0%, #d35400 100%); color:#111; pointer-events:none; }
.btn.indisp{ background:linear-gradient(180deg, #e74c3c 0%, #c0392b 100%); color:#fff; pointer-events:none; }
.card.novo{
  border-color:rgba(246,226,122,0.95);
  box-shadow: 0 20px 50px rgba(0,0,0,0.62), 0 0 0 1px rgba(246,226,122,0.10) inset, 0 0 22px rgba(199,160,8,0.10);
}

/* ======= POPUP NOTIF (SEU) ======= */
#notifPopupWrap{
  position:fixed;
  inset:0;
  z-index:999999;
  display:none;
  align-items:flex-end;
  justify-content:center;
  padding:14px;
  background:rgba(0,0,0,.40);
  backdrop-filter: blur(8px);
}
#notifSheet{
  width:min(620px, 100%);
  border-radius:22px 22px 18px 18px;
  border:1px solid rgba(199,160,8,.55);
  background:rgba(0,0,0,.94);
  box-shadow:0 30px 90px rgba(0,0,0,.70);
  padding:14px;
  transform:translateY(12px);
  animation:sheetIn .18s ease-out forwards;
}
@keyframes sheetIn{ to{ transform:translateY(0); } }
#notifHeader{
  display:flex;
  gap:12px;
  align-items:center;
  padding:6px 4px 10px;
}
#notifIcon{
  width:46px;height:46px;border-radius:14px;
  display:flex;align-items:center;justify-content:center;
  background:linear-gradient(180deg, rgba(246,226,122,.22), rgba(199,160,8,.10));
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 14px 30px rgba(0,0,0,.45);
  flex:0 0 auto;
}
#notifIcon svg{ width:24px;height:24px; opacity:.95; }
#notifTitle{ font-weight:900; font-size:15px; line-height:1.1; }
#notifDesc{ opacity:.90; font-size:13px; line-height:1.4; margin-top:4px; }
#notifBtns{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:10px;
  margin-top:10px;
}
@media (max-width:420px){ #notifBtns{ grid-template-columns:1fr; } }
.notifBtn{
  height:52px;
  border:0;
  border-radius:16px;
  font-weight:900;
  cursor:pointer;
  letter-spacing:.4px;
  font-family:'Poppins',sans-serif;
}
#notifEnable{ background:linear-gradient(180deg,#2ecc71,#1f9b50); color:#fff; }
#notifLater{
  background:rgba(255,255,255,.10);
  color:#fff;
  border:1px solid rgba(255,255,255,.12);
}
#notifHelp{
  margin-top:10px;
  padding:10px 12px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.06);
  font-size:12px;
  line-height:1.35;
  opacity:.92;
  display:none;
}
#notifHelp b{
  color:transparent;
  background-image:linear-gradient(180deg, var(--gold-2), var(--gold-3));
  -webkit-background-clip:text;
  background-clip:text;
}

/* ==========================================================
   ‚úÖ AVISO FIXO (SEMPRE) QUANDO:
   - permiss√£o negada
   - n√£o ativado ainda
   - Render offline (dormindo)
========================================================== */
#coNotifBanner{
  position:fixed;
  left:12px;
  right:12px;
  bottom:12px;
  z-index:999998;
  display:none;
  gap:10px;
  align-items:center;
  justify-content:space-between;
  padding:12px 12px;
  border-radius:18px;
  border:1px solid rgba(199,160,8,.55);
  background:rgba(0,0,0,.92);
  box-shadow:0 22px 60px rgba(0,0,0,.65);
}
#coNotifBanner .txt{
  font-size:12px;
  line-height:1.3;
  opacity:.95;
}
#coNotifBanner .actions{
  display:flex;
  gap:8px;
  flex:0 0 auto;
}
#coNotifBanner button{
  height:40px;
  padding:0 12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.08);
  color:#fff;
  font-weight:900;
  cursor:pointer;
  font-family:'Poppins',sans-serif;
}
#coNotifBanner button.primary{
  border:0;
  background:linear-gradient(180deg,#2ecc71,#1f9b50);
}
#coNotifBanner small{
  display:block;
  opacity:.75;
  margin-top:3px;
}
</style>
</head>

<body>

<div class="banner-carousel" id="bannerCarousel" aria-label="Carrossel de banners">
  <div class="spacer">
    <img src="https://i.ibb.co/4Z8xDjcV/Chat-GPT-Image-12-01-2026-04-49-28.png" alt="" />
  </div>

  <div class="slide active">
    <img src="https://i.ibb.co/4Z8xDjcV/Chat-GPT-Image-12-01-2026-04-49-28.png" alt="Consultas de tarot para clientes VIP" />
  </div>

  <div class="slide">
    <img src="https://i.ibb.co/bMmJcykt/Chat-GPT-Image-10-01-2026-22-08-33.png" alt="Como se consultar" />
  </div>

  <div class="slide">
    <img src="https://i.ibb.co/rRvmn4Q7/56e5b5c7-3199-4b85-a6d8-22608f6c0402.png" alt="Banner adicional" />
  </div>

  <div class="slide" id="slideVip">
    <img src="https://i.ibb.co/cKPNwmMY/Chat-GPT-Image-12-01-2026-07-11-40.png" alt="Consultas de Tarot Exclusivas para Clientes VIP" />
  </div>
</div>

<div class="page">
  <section class="hero">
    <h1>‚ú® Consultas de Tarot Exclusivas para Clientes VIP ‚ú®</h1>
    <div class="vip-aviso" aria-label="Aviso Leitura Sorteada VIP">
      <a href="https://marcio2307.github.io/cartomantesonline.site/sorteio.html">
        TODA SEXTA-FEIRA, A PARTIR DAS 18H, ROLA A LEITURA SORTEADA VIP!
      </a>
    </div>
  </section>

  <div class="container" id="cards-container"></div>
</div>

<!-- ‚úÖ Banner fixo de aviso (sempre que precisar) -->
<div id="coNotifBanner" role="status" aria-live="polite">
  <div class="txt" id="coNotifBannerTxt"></div>
  <div class="actions">
    <button id="coNotifBannerAction" class="primary" type="button">ATIVAR</button>
    <button id="coNotifBannerHide" type="button">OK</button>
  </div>
</div>

<div id="notifPopupWrap" role="dialog" aria-label="Ativar notifica√ß√µes">
  <div id="notifSheet">
    <div id="notifHeader">
      <div id="notifIcon" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M12 22a2.2 2.2 0 0 0 2.2-2.2h-4.4A2.2 2.2 0 0 0 12 22Z" fill="white" opacity=".92"/>
          <path d="M18 10.5c0-3.2-2-5.6-5-6.2V3a1 1 0 1 0-2 0v1.3c-3 .6-5 3-5 6.2V16l-1.4 1.4A1 1 0 0 0 5.3 19h13.4a1 1 0 0 0 .7-1.7L18 16v-5.5Z" fill="white" opacity=".92"/>
        </svg>
      </div>
      <div>
        <div id="notifTitle">Ativar notifica√ß√µes?</div>
        <div id="notifDesc">Receba avisos do painel (promo√ß√µes, chamadas e atualiza√ß√µes).</div>
      </div>
    </div>

    <div id="notifBtns">
      <button id="notifEnable" class="notifBtn" type="button">ATIVAR AGORA</button>
      <button id="notifLater" class="notifBtn" type="button">DEPOIS</button>
    </div>

    <div id="notifHelp"></div>
  </div>
</div>

<script>
/* ‚úÖ CARROSSEL (8s) */
(function initBannerCarousel(){
  const carousel = document.getElementById('bannerCarousel');
  if(!carousel) return;
  const slides = Array.from(carousel.querySelectorAll('.slide'));
  if(slides.length <= 1) return;
  let i = 0;
  function show(index){ slides.forEach((s, k) => s.classList.toggle('active', k === index)); }
  setInterval(() => { i = (i + 1) % slides.length; show(i); }, 8000);
})();

/* ==========================================================
   ‚úÖ SERVICE WORKER ABSOLUTO (GH Pages subpasta) + FORCE UPDATE
========================================================== */
async function ensureSW(){
  if(!("serviceWorker" in navigator)) return null;
  try{
    const reg = await navigator.serviceWorker.register(
      "/cartomantesonline.site/service-worker.js",
      { scope: "/cartomantesonline.site/" }
    );

    // ‚úÖ for√ßa checagem de atualiza√ß√£o (ajuda todo mundo receber SW novo)
    try { await reg.update(); } catch {}

    // ‚úÖ se existir SW novo "waiting", manda ativar agora
    try{
      if (reg.waiting) {
        reg.waiting.postMessage({ type: "SKIP_WAITING" });
      }
    }catch{}

    // ‚úÖ quando um SW novo assumir, recarrega (pra aplicar cache novo)
    try{
      let refreshing = false;
      navigator.serviceWorker.addEventListener("controllerchange", () => {
        if (refreshing) return;
        refreshing = true;
        location.reload();
      });
    }catch{}

    try{ await navigator.serviceWorker.ready; }catch{}
    return await navigator.serviceWorker.ready;
  }catch(e){
    return null;
  }
}
window.addEventListener("load", () => { ensureSW(); });

/* ===========================
   LISTA DE CONSULTORES (SEU)
=========================== */
const consultores = [
  { nome: "P.M√°rcio", valor: 2, imagem: "https://i.ibb.co/B5wwzSHD/Imagem-do-Whats-App-de-2025-10-31-s-12-44-22-8316baa5.jpg", estrelas: 5 },
  { nome: "Flora", valor: 1, imagem: "https://www.mestresmisticos.com.br/Assets/Imagens/2025/11/06//5dfb048cce-1-_3.webp", estrelas: 5, novo: true },
  { nome: "Carina", valor: 1, imagem: "https://www.mestresmisticos.com.br/Assets/Imagens/2025/12/04//5aea31bd77-1-_3.webp", estrelas: 5, novo: true },
  { nome: "Dalila", valor: 1, imagem: "https://www.mestresmisticos.com.br/Assets/Imagens/2025/10/11//0b284c7b42-1-_3.webp", estrelas: 5, novo: true },
  { nome: "Adria", valor: 1, imagem: "https://www.mestresmisticos.com.br/Assets/Imagens/2025/07/25//d6152621b2-1-_3.webp", estrelas: 5, novo: true },
  { nome: "Thabata", valor: 1, imagem: "https://www.mestresmisticos.com.br/Assets/Imagens/2025/06/28//d5969655ef-1-_3.webp", estrelas: 5, novo: true },
  { nome: "Analu", valor: 1, imagem: "https://www.mestresmisticos.com.br/Assets/Imagens/2025/12/19//fe3f4b6a8a-1-_3.webp", estrelas: 5, novo: true },
  { nome: "Benedita", valor: 1, imagem: "https://www.mestresmisticos.com.br/Assets/Imagens/2025/10/23//9f9ffa4ba9-1-_3.webp", estrelas: 5, novo: true },
  { nome: "Estrela", valor: 1, imagem: "https://www.mestresmisticos.com.br/Assets/Imagens/2026/01/01//b2a24fc4f7-1-_3.webp", estrelas: 5, novo: true },
  { nome: "Sulamita", valor: 1, imagem: "https://www.rainhasdotarot.com.br/Assets/Imagens/2024/05/27//47a447851c-1-.jpg", estrelas: 5 },
  { nome: "Esmeralda", valor: 1, imagem: "https://www.rainhasdotarot.com.br/Assets/Imagens/2020/05/18//41c4696d05-1-.jpg", estrelas: 5 },
  { nome: "M.Padilha", valor: 1, imagem: "https://www.rainhasdotarot.com.br/Assets/Imagens/2025/01/27//699974ac8a-1-.jpg", estrelas: 4 },
  { nome: "Sara", valor: 1, imagem: "https://www.rainhasdotarot.com.br/Assets/Imagens/2024/09/04//9a6f4cec30-1-.jpg", estrelas: 5 },
  { nome: "7 Saias", valor: 1, imagem: "https://www.rainhasdotarot.com.br/Assets/Imagens/2024/02/29//e43513a707-1-.jpg", estrelas: 5 },
  { nome: "Odara", valor: 1, imagem: "https://www.rainhasdotarot.com.br/Assets/Imagens/2024/01/15//91bb2a4455-1-.jpg", estrelas: 5 },
  { nome: "Luara", valor: 1, imagem: "https://www.rainhasdotarot.com.br/Assets/Imagens/2024/08/24//dc4e2cb494-1-.jpg", estrelas: 5 }
];

const container = document.getElementById('cards-container');

consultores.forEach((c, idx) => {
  const card = document.createElement('div');
  card.className = 'card' + (c.novo ? ' novo' : '');
  card.dataset.idx = String(idx);

  card.innerHTML = `
    <div class="img-wrap">
      <img src="${c.imagem}" alt="${c.nome}">
    </div>
    <span class="badge">Online</span>
    <div class="content">
      <div class="name">${c.nome} <span class="dot"></span></div>
      <div class="stars">${'‚òÖ'.repeat(c.estrelas)}${'‚òÜ'.repeat(5 - c.estrelas)}</div>
      <div class="price"><b>R$ ${Number(c.valor).toFixed(2)} por minuto</b></div>
      <a href="#" class="btn disponivel">INICIAR CONSULTA</a>
    </div>
  `;

  card.querySelector('.btn').addEventListener('click', (e) => {
    e.preventDefault();
    if (card.dataset.status !== "online") return;

    localStorage.setItem('consultorNome', c.nome);
    localStorage.setItem('consultorValor', String(c.valor));
    localStorage.setItem('consultorImagem', c.imagem);

    window.location.href = 'https://marcio2307.github.io/cartomantesonline.site/pacotes.html';
  });

  container.appendChild(card);
});

/* ===========================
   STATUS REALISTA (SEU)
=========================== */
function chance(p){ return Math.random() < p; }
const STORAGE_KEY = "status_realista_v3";
let estado = null;

function carregarEstado(){
  try{
    const raw = sessionStorage.getItem(STORAGE_KEY);
    if(!raw) return null;
    const parsed = JSON.parse(raw);
    if(!parsed || !Array.isArray(parsed.consultores)) return null;
    return parsed;
  }catch{ return null; }
}
function salvarEstado(){ try{ sessionStorage.setItem(STORAGE_KEY, JSON.stringify(estado)); }catch{} }

function setStatusDOM(card, status){
  const badge = card.querySelector('.badge');
  const dot = card.querySelector('.dot');
  const btn = card.querySelector('.btn');

  card.dataset.status = status;

  badge.classList.remove('ocupado','indisp');
  dot.classList.remove('ocupado','indisp');
  btn.classList.remove('ocupado','indisp','disponivel');

  dot.style.animation = '';

  if(status === "online"){
    badge.textContent = 'Online';
    dot.style.animation = 'blink 1s infinite';
    btn.textContent = 'INICIAR CONSULTA';
    btn.classList.add('disponivel');
    btn.style.pointerEvents = '';
  }else if(status === "ocupado"){
    badge.textContent = 'Ocupado';
    badge.classList.add('ocupado');
    dot.classList.add('ocupado');
    dot.style.animation = 'none';
    btn.textContent = 'OCUPADO';
    btn.classList.add('ocupado');
    btn.style.pointerEvents = 'none';
  }else{
    badge.textContent = 'Indispon√≠vel';
    badge.classList.add('indisp');
    dot.classList.add('indisp');
    dot.style.animation = 'none';
    btn.textContent = 'INDISPON√çVEL';
    btn.classList.add('indisp');
    btn.style.pointerEvents = 'none';
  }
}
function todosIndisponiveisAgora(){
  const h = new Date().getHours();
  return (h >= 2 && h < 10);
}
function initEstado(){
  const dia = new Date().toDateString();
  const anterior = carregarEstado();
  if(anterior && anterior.dia === dia && anterior.consultores?.length === consultores.length){
    estado = anterior;
    return;
  }
  estado = { dia, consultores: consultores.map(() => ({ status:"online", holdUntil:0 })) };
  aplicarStatusRealista(true);
  salvarEstado();
}
function escolherIndisponiveis(cards){
  const total = cards.length;
  const qtd = chance(0.55) ? 1 : 2;
  const indices = [...Array(total)].map((_,i)=>i);
  for(let i=indices.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [indices[i], indices[j]] = [indices[j], indices[i]];
  }
  return new Set(indices.slice(0, Math.min(qtd, total)));
}
function aplicarStatusRealista(forceAll=false){
  const now = Date.now();
  const hora = new Date().getHours();
  const cards = Array.from(document.querySelectorAll('.card'));

  if(todosIndisponiveisAgora()){
    cards.forEach((card, i) => {
      const st = estado.consultores[i];
      st.status = "indisp";
      st.holdUntil = now + 60 * 1000;
      setStatusDOM(card, "indisp");
    });
    salvarEstado();
    return;
  }

  let ocupProb = 0.40;
  if (hora >= 9 && hora < 12) ocupProb = 0.34;
  if (hora >= 12 && hora < 17) ocupProb = 0.44;
  if (hora >= 17 && hora < 22) ocupProb = 0.56;
  if (hora >= 22 || hora < 6) ocupProb = 0.38;

  const indispSet = escolherIndisponiveis(cards);

  cards.forEach((card, i) => {
    const st = estado.consultores[i];
    const emHold = !forceAll && st.holdUntil && now < st.holdUntil;
    if (emHold){ setStatusDOM(card, st.status); return; }

    if (indispSet.has(i)){
      st.status = "indisp";
      st.holdUntil = now + Math.floor((2 + Math.random()*3) * 60 * 1000);
      setStatusDOM(card, "indisp");
      return;
    }

    const novoStatus = chance(ocupProb) ? "ocupado" : "online";
    st.status = novoStatus;
    st.holdUntil = (novoStatus === "ocupado")
      ? now + Math.floor((2 + Math.random()*4) * 60 * 1000)
      : now + Math.floor((1 + Math.random()*2) * 60 * 1000);

    setStatusDOM(card, novoStatus);
  });

  salvarEstado();
}
initEstado();
aplicarStatusRealista(false);
setInterval(() => aplicarStatusRealista(false), 20000);
document.addEventListener('visibilitychange', () => { if (!document.hidden) aplicarStatusRealista(false); });

/* ==========================================================
   ‚úÖ PUSH REAL (RENDER) ‚Äî chega com app fechado
========================================================== */
const RENDER_URL = "https://teste1-y25k.onrender.com";
const VAPID_PUBLIC_KEY = "BLbTJKYvaDqGA8lE7fYgx-3mzOjCT6-pIAuidCwC08NCW3BzV0V1I4YjgkUrfJJvCySdom-X4MaxGowioHjjoaE";

function urlBase64ToUint8Array(base64String) {
  const padding = "=".repeat((4 - (base64String.length % 4)) % 4);
  const base64 = (base64String + padding).replace(/-/g, "+").replace(/_/g, "/");
  const rawData = atob(base64);
  const outputArray = new Uint8Array(rawData.length);
  for (let i = 0; i < rawData.length; ++i) outputArray[i] = rawData.charCodeAt(i);
  return outputArray;
}

function getOrMakeDeviceId(){
  const KEY = "co_render_device_id_v1";
  let id = localStorage.getItem(KEY);
  if(id && id.length > 8) return id;
  id = "dev_" + Math.random().toString(36).slice(2) + Date.now().toString(36);
  localStorage.setItem(KEY, id);
  return id;
}
const deviceId = getOrMakeDeviceId();

async function fetchWithTimeout(url, opts={}, timeoutMs=8000){
  const ctrl = new AbortController();
  const t = setTimeout(() => ctrl.abort(), timeoutMs);
  try{
    const res = await fetch(url, { ...opts, signal: ctrl.signal, cache:"no-store" });
    return res;
  }finally{
    clearTimeout(t);
  }
}

async function subscribeOnRender(){
  const reg = await ensureSW();
  if(!reg) throw new Error("Service Worker n√£o ficou ativo. Verifique /cartomantesonline.site/service-worker.js");

  if (!("PushManager" in window)) throw new Error("Push n√£o suportado neste navegador.");
  if (!("Notification" in window)) throw new Error("Notifica√ß√µes n√£o suportadas.");

  if (Notification.permission === "denied") {
    throw new Error("Notifica√ß√µes bloqueadas. V√° em Permiss√µes do site e permita.");
  }

  const perm = await Notification.requestPermission();
  if (perm !== "granted") throw new Error("Permiss√£o n√£o concedida.");

  // ‚úÖ garante subscription v√°lida
  let sub = await reg.pushManager.getSubscription();
  if(!sub){
    sub = await reg.pushManager.subscribe({
      userVisibleOnly: true,
      applicationServerKey: urlBase64ToUint8Array(VAPID_PUBLIC_KEY)
    });
  }

  // ‚úÖ registra/atualiza no Render (sempre)
  const res = await fetchWithTimeout(RENDER_URL + "/api/subscribe", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      subscription: sub,
      page: location.href,
      site: "cartomantesonline.site",
      app: "leituras",
      deviceId,
      createdAt: new Date().toISOString(),
      ua: navigator.userAgent
    })
  }, 10000);

  if(!res.ok){
    const txt = await res.text().catch(()=> "");
    throw new Error("Falha no Render /api/subscribe: " + res.status + " " + txt);
  }

  return true;
}

/* ==========================================================
   ‚úÖ BANNER FIXO (AVISOS)
========================================================== */
(function notifBanner(){
  const banner = document.getElementById("coNotifBanner");
  const txt = document.getElementById("coNotifBannerTxt");
  const btn = document.getElementById("coNotifBannerAction");
  const hide = document.getElementById("coNotifBannerHide");
  if(!banner || !txt || !btn || !hide) return;

  const KEY_HIDE_UNTIL = "co_notif_banner_hide_until_v1";

  function show(message, actionText="ATIVAR"){
    const until = Number(localStorage.getItem(KEY_HIDE_UNTIL) || "0");
    if (until && Date.now() < until) return;

    txt.innerHTML = message;
    btn.textContent = actionText;
    banner.style.display = "flex";
  }
  function hideNow(ms=10*60*1000){
    banner.style.display = "none";
    localStorage.setItem(KEY_HIDE_UNTIL, String(Date.now() + ms));
  }

  hide.addEventListener("click", () => hideNow());

  btn.addEventListener("click", async () => {
    // abre popup (o handler principal vai cuidar do fluxo)
    try{
      window.__coOpenNotifPopup?.();
    }catch{}
  });

  // exp√µe helpers
  window.__coBannerShow = show;
  window.__coBannerHide = hideNow;
})();

/* ==========================================================
   ‚úÖ POPUP (ESSENCIAL) ‚Äî ativa e registra no Render
   + pede ao abrir / se Render cair / se recusado: aviso sempre
========================================================== */
(function notifPermissionUX(){
  const wrap   = document.getElementById("notifPopupWrap");
  const enable = document.getElementById("notifEnable");
  const later  = document.getElementById("notifLater");
  const help   = document.getElementById("notifHelp");
  if(!wrap || !enable || !later) return;

  const KEY_SNOOZE_UNTIL  = "co_notif_snooze_until_render_v2";
  const REMIND_AFTER_MS = 90 * 1000;

  function showWrap(){ wrap.style.display = "flex"; }
  function hideWrap(){ wrap.style.display = "none"; }
  function showHelp(html){
    if(!help) return;
    help.style.display = "block";
    help.innerHTML = html;
  }
  function clearHelp(){
    if(!help) return;
    help.style.display = "none";
    help.innerHTML = "";
  }
  function isStandalone(){
    return (window.matchMedia && window.matchMedia("(display-mode: standalone)").matches) || window.navigator.standalone === true;
  }
  function isIOS(){
    return /iphone|ipad|ipod/i.test(navigator.userAgent || "");
  }

  function shouldShowNow(force=false){
    if(!("Notification" in window)) return false;
    if(Notification.permission === "granted") return false;

    if(!force){
      const until = Number(localStorage.getItem(KEY_SNOOZE_UNTIL) || "0");
      if(until && Date.now() < until) return false;
    }
    return true;
  }

  async function openPopupIfNeeded(force=false){
    if(!shouldShowNow(force)) return;

    clearHelp();
    showWrap();

    if(isIOS() && !isStandalone()){
      showHelp(
        `No <b>iPhone</b>, as notifica√ß√µes s√≥ funcionam quando o site est√° <b>instalado</b>.<br>`+
        `Toque em <b>Compartilhar</b> ‚Üí <b>Adicionar √† Tela de In√≠cio</b> e abra por l√°.<br>`+
        `Depois volte aqui e toque em <b>ATIVAR AGORA</b>.`
      );
    }

    if(Notification.permission === "denied"){
      showHelp(
        `Notifica√ß√µes est√£o <b>bloqueadas</b> neste aparelho.<br>`+
        `Abra as permiss√µes do site e permita notifica√ß√µes.`
      );
      // ‚úÖ aviso fixo sempre quando recusado
      try{
        window.__coBannerShow?.(
          `‚ö†Ô∏è Notifica√ß√µes <b>bloqueadas</b>. Para receber avisos, entre nas permiss√µes do navegador e <b>permita</b> notifica√ß√µes.<small>Sem isso, o app n√£o consegue avisar promo√ß√µes e chamadas.</small>`,
          "COMO ATIVAR"
        );
      }catch{}
    }else{
      // ‚úÖ ainda n√£o concedeu
      try{
        window.__coBannerShow?.(
          `üîî Ative as notifica√ß√µes para receber avisos com o app fechado.<small>√â necess√°rio para promo√ß√µes, chamadas e atualiza√ß√µes.</small>`,
          "ATIVAR"
        );
      }catch{}
    }
  }

  // ‚úÖ permite bot√£o do banner abrir popup
  window.__coOpenNotifPopup = () => openPopupIfNeeded(true);

  // ‚úÖ pede ao abrir
  setTimeout(() => openPopupIfNeeded(false), 1200);

  // ‚úÖ pede quando volta pra aba
  document.addEventListener("visibilitychange", () => {
    if(!document.hidden){
      setTimeout(() => openPopupIfNeeded(false), 500);
    }
  });

  later.onclick = () => {
    hideWrap();
    localStorage.setItem(KEY_SNOOZE_UNTIL, String(Date.now() + REMIND_AFTER_MS));
    // mant√©m banner (mas deixa a pessoa respirar um pouco)
    try{ window.__coBannerShow?.(
      `üîî Voc√™ pode ativar as notifica√ß√µes a qualquer momento.<small>Toque em <b>ATIVAR</b> para liberar.</small>`,
      "ATIVAR"
    ); }catch{}
  };

  enable.onclick = async () => {
    try{
      showHelp("Ativando notifica√ß√µes e registrando no servidor...");
      await subscribeOnRender();

      hideWrap();
      localStorage.removeItem(KEY_SNOOZE_UNTIL);

      try{ window.__coBannerHide?.(60*60*1000); }catch{} // esconde por 1h

      // ‚úÖ teste local imediato
      try{
        const reg = await navigator.serviceWorker.ready;
        reg.showNotification("Notifica√ß√µes ativadas ‚úÖ", {
          body: "Tudo certo! Voc√™ j√° pode receber avisos com o app fechado.",
          icon: "/cartomantesonline.site/logo.png",
          badge: "/cartomantesonline.site/logo.png",
          data: { url: "/cartomantesonline.site/leituras.html?pwa=true" }
        });
      }catch{}

    }catch(e){
      showHelp("‚ùå " + (e?.message || e));
      localStorage.setItem(KEY_SNOOZE_UNTIL, String(Date.now() + 20*1000));
      setTimeout(() => openPopupIfNeeded(true), 20050);
    }
  };
})();

/* ==========================================================
   ‚úÖ DETECTOR "RENDER DORMIU" + AUTO-RECONEX√ÉO
   - se render cair/offline: mostra aviso e tenta reconectar
   - se voltar: registra novamente /api/subscribe
========================================================== */
(function renderWatcher(){
  const CHECK_EVERY_MS = 25000;
  const FAILS_TO_WARN = 2;

  let fails = 0;
  let lastOkAt = 0;

  async function ping(){
    // endpoint "barato": se voc√™ n√£o tiver /health, o fetch vai falhar e j√° serve
    // (o importante √© detectar que o Render ficou fora do ar)
    try{
      const res = await fetchWithTimeout(RENDER_URL + "/health", { method:"GET" }, 7000);
      if(!res.ok) throw new Error("status " + res.status);
      return true;
    }catch{
      // tenta um fallback que quase sempre existe:
      try{
        const res2 = await fetchWithTimeout(RENDER_URL + "/", { method:"GET" }, 7000);
        if(!res2.ok) throw new Error("status " + res2.status);
        return true;
      }catch{
        return false;
      }
    }
  }

  async function tick(){
    const ok = await ping();

    if(ok){
      fails = 0;
      lastOkAt = Date.now();

      // se j√° tem permiss√£o, tenta garantir que est√° registrado (muito importante!)
      if ("Notification" in window && Notification.permission === "granted") {
        try{ await subscribeOnRender(); }catch{}
      }
      return;
    }

    fails++;
    if (fails >= FAILS_TO_WARN){
      const secs = lastOkAt ? Math.floor((Date.now() - lastOkAt)/1000) : 0;

      // ‚úÖ mostra aviso fixo
      try{
        window.__coBannerShow?.(
          `‚ö†Ô∏è Servidor temporariamente offline (Render dormiu).<small>Tentando reconectar... ${secs ? ("(" + secs + "s)") : ""}</small>`,
          ("Notification" in window && Notification.permission === "granted") ? "RECONectar" : "ATIVAR"
        );
      }catch{}

      // ‚úÖ se n√£o tem permiss√£o, pede de novo (como voc√™ pediu)
      if ("Notification" in window && Notification.permission !== "granted") {
        try{ window.__coOpenNotifPopup?.(); }catch{}
      } else {
        // ‚úÖ se tem permiss√£o, tenta refazer subscribe (quando render dorme, isso ajuda)
        try{ await subscribeOnRender(); }catch{}
      }
    }
  }

  setTimeout(() => { tick(); setInterval(tick, CHECK_EVERY_MS); }, 2500);
})();
</script>

</body>
</html>
