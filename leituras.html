<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Consultores Dispon√≠veis</title>

<!-- ‚úÖ PWA -->
<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#000000">
<meta name="apple-mobile-web-app-capable" content="yes">

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />

<style>
:root{
  --gold-1:#fff0a6;
  --gold-2:#f6e27a;
  --gold-3:#c7a008;
  --gold-4:#b8860b;
  --black:#000000;

  --btn-h:56px;
  --btn-px:14px;
}

body{
  margin:0;
  min-height:100vh;
  background:
    radial-gradient(900px 420px at 15% 10%, rgba(199,160,8,0.20), rgba(0,0,0,0) 60%),
    radial-gradient(900px 420px at 85% 20%, rgba(199,160,8,0.16), rgba(0,0,0,0) 60%),
    radial-gradient(1200px 520px at 50% 120%, rgba(199,160,8,0.10), rgba(0,0,0,0) 65%),
    #000;
  font-family:'Poppins',sans-serif;
  color:#fff;
}

/* ‚úÖ CARROSSEL DE BANNERS (SEM CORTE) */
.banner-carousel{
  width:100%;
  margin:0;
  border-bottom:2px solid var(--gold-3);
  box-shadow:0 18px 60px rgba(0,0,0,0.55);
  position:relative;
  background:#000;
  overflow:hidden;
}
.banner-carousel::after{
  content:"";
  position:absolute;
  inset:0;
  background:
    radial-gradient(1200px 520px at 50% 15%, rgba(0,0,0,0.10), rgba(0,0,0,0.48) 60%),
    linear-gradient(180deg, rgba(0,0,0,0.02) 0%, rgba(0,0,0,0.35) 100%);
  pointer-events:none;
  z-index:3;
}
.banner-carousel .slide{
  position:absolute;
  inset:0;
  opacity:0;
  transition:opacity .45s ease;
  z-index:1;
}
.banner-carousel .slide.active{
  opacity:1;
  z-index:2;
}
.banner-carousel img{
  width:100%;
  height:auto;
  display:block;
}
.banner-carousel .spacer{
  width:100%;
  pointer-events:none;
}
.banner-carousel .spacer img{
  opacity:0;
  visibility:hidden;
}

@media (max-width:480px){
  .banner-carousel{ border-bottom-width:1px; }
  :root{
    --btn-h:64px;
    --btn-px:16px;
  }
}

.page{
  padding:22px 20px 28px;
}

/* Hero */
.hero{
  max-width:1200px;
  margin:0 auto 22px;
  text-align:center;
  padding:0 10px;
}
.hero h1{
  margin:0 0 10px;
  font-size:36px;
  font-weight:800;
  letter-spacing:0.2px;
  color:transparent;
  background-image: linear-gradient(180deg, var(--gold-2) 0%, var(--gold-3) 42%, var(--gold-1) 72%, var(--gold-4) 100%);
  -webkit-background-clip:text;
  background-clip:text;
  text-shadow:0 0 22px rgba(199,160,8,0.15);
}

/* ‚úÖ OP√á√ÉO A (AVISO) ‚Äî MAIS CENTRALIZADO E BONITO NO CELULAR */
.hero .vip-aviso{
  display:flex;
  justify-content:center;
  width:100%;
  margin:14px auto 0;
}
.hero .vip-aviso a{
  width:min(760px, 100%);
  min-height:66px;

  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;

  padding:16px 16px;
  border-radius:20px;
  text-decoration:none;

  font-weight:900;
  letter-spacing:.4px;
  line-height:1.25;
  color:#111;

  background:linear-gradient(180deg, var(--gold-1) 0%, var(--gold-2) 45%, var(--gold-3) 100%);
  border:1px solid rgba(255,255,255,0.18);
  box-shadow:
    0 22px 46px rgba(0,0,0,0.65),
    0 0 0 1px rgba(255,240,166,0.10) inset;

  text-transform:uppercase;
  -webkit-tap-highlight-color: transparent;
}
.hero .vip-aviso a:hover{ filter:brightness(1.05); }
.hero .vip-aviso a:active{ transform: translateY(1px); }

@media (max-width:480px){
  .hero .vip-aviso{ margin-top:12px; }
  .hero .vip-aviso a{
    width:100%;
    min-height:74px;
    padding:16px 14px;
    font-size:13px;
    letter-spacing:.35px;
    border-radius:18px;
  }
}

/* Grid */
.container{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:20px;
  max-width:1200px;
  margin:0 auto;
}
@media (max-width:1024px){ .container{ grid-template-columns:repeat(3,1fr); } }
@media (max-width:768px){
  .container{ grid-template-columns:repeat(2,1fr); gap:15px; }
  .hero h1{ font-size:30px; }
}
@media (max-width:480px){
  .container{ grid-template-columns:repeat(2,1fr); gap:12px; }
  .hero h1{ font-size:26px; }
}

/* ‚úÖ Cards elegantes */
.card{
  position:relative;
  border-radius:18px;
  overflow:hidden;
  isolation:isolate;

  background:
    radial-gradient(560px 260px at 50% -10%, rgba(199,160,8,0.25), rgba(0,0,0,0) 60%),
    linear-gradient(180deg, rgba(18,18,18,0.86) 0%, rgba(5,5,5,0.98) 100%);

  border:1px solid rgba(199,160,8,0.55);
  box-shadow:
    0 18px 44px rgba(0,0,0,0.60),
    0 0 0 1px rgba(255,240,166,0.08) inset;

  transform:none !important;
  transition:none;
}
.card::before{
  content:"";
  position:absolute;
  inset:-2px;
  background:
    radial-gradient(520px 220px at 50% 0%, rgba(246,226,122,0.22), rgba(0,0,0,0) 60%),
    radial-gradient(180px 120px at 18% 18%, rgba(255,240,166,0.10), rgba(0,0,0,0) 70%),
    radial-gradient(180px 120px at 82% 28%, rgba(255,240,166,0.08), rgba(0,0,0,0) 70%);
  opacity:.9;
  pointer-events:none;
  z-index:0;
}
.card::after{
  content:"";
  position:absolute;
  inset:0;
  background:
    linear-gradient(120deg,
      rgba(255,240,166,0.00) 0%,
      rgba(255,240,166,0.04) 28%,
      rgba(255,240,166,0.00) 55%,
      rgba(255,240,166,0.00) 100%);
  mix-blend-mode:screen;
  opacity:.55;
  pointer-events:none;
  z-index:1;
}
.card:hover{
  border-color:rgba(246,226,122,0.95);
  box-shadow:
    0 18px 44px rgba(0,0,0,0.60),
    0 0 30px rgba(199,160,8,0.14),
    0 0 0 1px rgba(255,240,166,0.10) inset;
}

.card .img-wrap{
  position:relative;
  z-index:2;
  padding:10px 10px 0;
}
.card .img-wrap img{
  width:100%;
  height:240px;
  object-fit:cover;
  display:block;
  border-radius:14px;
  border:1px solid rgba(199,160,8,0.35);
  box-shadow:
    0 12px 30px rgba(0,0,0,0.55),
    0 0 0 1px rgba(255,240,166,0.06) inset;
  filter:saturate(1.06) contrast(1.06);
}
.card .img-wrap::after{
  content:"";
  position:absolute;
  left:10px; right:10px; bottom:0;
  height:86px;
  border-radius:0 0 14px 14px;
  background:linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.85) 100%);
  pointer-events:none;
}

/* Badge */
.badge{
  position:absolute;
  top:16px;
  left:16px;
  padding:7px 11px;
  font-size:11px;
  border-radius:999px;
  text-transform:uppercase;
  color:#fff;
  font-weight:900;
  letter-spacing:0.6px;
  box-shadow:0 10px 18px rgba(0,0,0,0.50);
  z-index:4;
  border:1px solid rgba(255,255,255,0.18);
  background:linear-gradient(180deg, #2ecc71 0%, #1f9b50 100%);
}
.badge.ocupado{ background:linear-gradient(180deg, #f39c12 0%, #d35400 100%); }
.badge.indisp{ background:linear-gradient(180deg, #e74c3c 0%, #c0392b 100%); }

.content{
  padding:12px 14px 16px;
  position:relative;
  z-index:3;
}

.name{
  font-family:'Cinzel', serif;
  font-size:16px;
  font-weight:800;
  text-align:center;
  margin:6px 0 8px;
  display:flex;
  justify-content:center;
  align-items:center;
  gap:8px;
  color:transparent;
  background-image:linear-gradient(180deg, var(--gold-1) 0%, var(--gold-3) 52%, var(--gold-2) 100%);
  -webkit-background-clip:text;
  background-clip:text;
  text-shadow:0 0 18px rgba(199,160,8,0.12);
}

.dot{
  width:9px; height:9px;
  border-radius:50%;
  background:#2ecc71;
  animation:blink 1s infinite;
  box-shadow:0 0 12px rgba(46,204,113,0.40);
}
@keyframes blink{ 50%{ opacity:0; } }
.dot.ocupado{ background:#e67e22; animation:none; box-shadow:none; }
.dot.indisp{ background:#e74c3c; animation:none; box-shadow:none; }

.stars{
  color:transparent;
  background-image:linear-gradient(180deg, var(--gold-2) 0%, var(--gold-3) 55%, var(--gold-4) 100%);
  -webkit-background-clip:text;
  background-clip:text;
  text-align:center;
  margin-bottom:8px;
  font-size:14px;
  text-shadow:0 0 18px rgba(199,160,8,0.12);
}

.price{
  text-align:center;
  font-size:13px;
  color:rgba(255,255,255,0.90);
  margin-bottom:12px;
}
.price b{
  color:transparent;
  background-image:linear-gradient(180deg, var(--gold-2) 0%, var(--gold-3) 45%, var(--gold-1) 80%);
  -webkit-background-clip:text;
  background-clip:text;
}

/* Bot√µes */
.btn{
  width:100%;
  height:var(--btn-h);
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  padding:0 var(--btn-px);
  border-radius:16px;
  text-decoration:none;
  font-weight:900;
  font-size:13px;
  letter-spacing:0.7px;
  line-height:1.15;
  white-space:normal;
  overflow:visible;
  box-sizing:border-box;
  box-shadow:
    0 16px 30px rgba(0,0,0,0.55),
    0 0 0 1px rgba(255,240,166,0.06) inset;
  border:1px solid rgba(255,255,255,0.10);
  transition:filter .18s ease;
}
@media (max-width:480px){
  .btn{ font-size:12px; }
}

/* ‚úÖ DISPON√çVEL = VERDE */
.btn.disponivel{
  background:linear-gradient(180deg, #2ecc71 0%, #1f9b50 100%);
  color:#fff;
  border-color:rgba(255,255,255,0.16);
}
.btn:hover{ filter:brightness(1.06); }

.btn.ocupado{
  background:linear-gradient(180deg, #f39c12 0%, #d35400 100%);
  color:#111;
  pointer-events:none;
}
.btn.indisp{
  background:linear-gradient(180deg, #e74c3c 0%, #c0392b 100%);
  color:#fff;
  pointer-events:none;
}

.card.novo{
  border-color:rgba(246,226,122,0.95);
  box-shadow:
    0 20px 50px rgba(0,0,0,0.62),
    0 0 0 1px rgba(246,226,122,0.10) inset,
    0 0 22px rgba(199,160,8,0.10);
}

/* ==========================================================
   ‚úÖ BLOQUEIO DE PROPAGANDAS INJETADAS (FabApp / similares)
========================================================== */
fabapp-banner-footer,
fabapp-banner-footer *{
  display:none !important;
  visibility:hidden !important;
  opacity:0 !important;
  height:0 !important;
  max-height:0 !important;
  min-height:0 !important;
  width:0 !important;
  max-width:0 !important;
  overflow:hidden !important;
  pointer-events:none !important;
}

#ads-container,
[id="ads-container"],
[id*="ads-container"],
[class*="ads-container"],
iframe[src*="fabapp-ads"],
video[src*="fabapp-ads"],
source[src*="fabapp-ads"]{
  display:none !important;
  visibility:hidden !important;
  opacity:0 !important;
  height:0 !important;
  max-height:0 !important;
  overflow:hidden !important;
  pointer-events:none !important;
}

/* ==========================================================
   ‚úÖ UI DO POPUP DE NOTIFICA√á√ÉO
========================================================== */
#notifBar{
  position:fixed;
  left:12px;
  right:12px;
  bottom:12px;
  z-index:99999;
  display:none;
}
#notifBar .box{
  border-radius:18px;
  padding:14px 14px;
  border:1px solid rgba(199,160,8,0.55);
  background:
    radial-gradient(560px 260px at 50% -10%, rgba(199,160,8,0.20), rgba(0,0,0,0) 60%),
    linear-gradient(180deg, rgba(18,18,18,0.92) 0%, rgba(5,5,5,0.98) 100%);
  box-shadow:0 18px 44px rgba(0,0,0,0.65);
}
#notifBar .title{
  font-weight:900;
  letter-spacing:.3px;
  margin:0 0 6px;
  color:transparent;
  background-image:linear-gradient(180deg, var(--gold-1) 0%, var(--gold-3) 55%, var(--gold-2) 100%);
  -webkit-background-clip:text;
  background-clip:text;
}
#notifBar .msg{
  margin:0 0 10px;
  font-size:13px;
  opacity:.9;
  line-height:1.25;
}
#notifBar .row{ display:flex; gap:10px; }
#notifBtn{
  flex:1;
  height:46px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,0.12);
  background:linear-gradient(180deg, #2ecc71 0%, #1f9b50 100%);
  color:#fff;
  font-weight:900;
  letter-spacing:.6px;
  cursor:pointer;
}
#notifClose{
  width:56px;
  height:46px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,0.10);
  background:rgba(255,255,255,0.06);
  color:#fff;
  font-weight:900;
  cursor:pointer;
}
#notifStatus{
  margin-top:8px;
  font-size:12px;
  opacity:.85;
  white-space:pre-wrap;
}
</style>
</head>

<body>

<!-- ‚úÖ Carrossel (8s) -->
<div class="banner-carousel" id="bannerCarousel" aria-label="Carrossel de banners">
  <div class="spacer">
    <img src="https://i.ibb.co/4Z8xDjcV/Chat-GPT-Image-12-01-2026-04-49-28.png" alt="" />
  </div>

  <div class="slide active">
    <img src="https://i.ibb.co/4Z8xDjcV/Chat-GPT-Image-12-01-2026-04-49-28.png" alt="Consultas de tarot para clientes VIP" />
  </div>

  <div class="slide">
    <img src="https://i.ibb.co/bMmJcykt/Chat-GPT-Image-10-01-2026-22-08-33.png" alt="Como se consultar" />
  </div>

  <div class="slide">
    <img src="https://i.ibb.co/rRvmn4Q7/56e5b5c7-3199-4b85-a6d8-22608f6c0402.png" alt="Banner adicional" />
  </div>

  <div class="slide" id="slideVip">
    <img src="https://i.ibb.co/cKPNwmMY/Chat-GPT-Image-12-01-2026-07-11-40.png" alt="Consultas de Tarot Exclusivas para Clientes VIP" />
  </div>
</div>

<div class="page">
  <section class="hero">
    <h1>‚ú® Consultas de Tarot Exclusivas para Clientes VIP ‚ú®</h1>
    <div class="vip-aviso" aria-label="Aviso Leitura Sorteada VIP">
      <a href="https://marcio2307.github.io/cartomantesonline.site/sorteio.html">
        TODA SEXTA-FEIRA, A PARTIR DAS 18H, ROLA A LEITURA SORTEADA VIP!
      </a>
    </div>
  </section>

  <div class="container" id="cards-container"></div>
</div>

<div id="notifBar" role="dialog" aria-live="polite" aria-label="Ativar notifica√ß√µes">
  <div class="box">
    <div class="title">üîî Ative as notifica√ß√µes</div>
    <p class="msg">Receba avisos no celular quando tiver novidades importantes.</p>
    <div class="row">
      <button id="notifBtn" type="button">ATIVAR NOTIFICA√á√ïES</button>
      <button id="notifClose" type="button" aria-label="Fechar">‚úï</button>
    </div>
    <div id="notifStatus"></div>
  </div>
</div>

<script>
/* ==========================================================
   ‚úÖ REMO√á√ÉO FOR√áADA (se o host injetar de novo, apaga na hora)
========================================================== */
(function bloquearPropagandasInjetadas(){
  const SELECTORS = [
    'fabapp-banner-footer',
    'fabapp-banner-footer video',
    '#ads-container',
    '[id="ads-container"]',
    'iframe[src*="fabapp-ads"]',
    'video[src*="fabapp-ads"]',
    'source[src*="fabapp-ads"]',
    'script[src*="fabapp-ads"]'
  ];

  function remover() {
    for (const sel of SELECTORS) {
      document.querySelectorAll(sel).forEach(el => {
        try { el.remove(); } catch {}
      });
    }
  }

  remover();
  const obs = new MutationObserver(() => remover());
  obs.observe(document.documentElement, { childList:true, subtree:true });

  let tries = 0;
  const t = setInterval(() => {
    remover();
    tries++;
    if (tries >= 30) clearInterval(t);
  }, 500);
})();

/* ===========================
   ‚úÖ CARROSSEL (8s)
=========================== */
(function initBannerCarousel(){
  const carousel = document.getElementById('bannerCarousel');
  if(!carousel) return;

  const slides = Array.from(carousel.querySelectorAll('.slide'));
  if(slides.length <= 1) return;

  let i = 0;
  function show(index){
    slides.forEach((s, k) => s.classList.toggle('active', k === index));
  }
  setInterval(() => {
    i = (i + 1) % slides.length;
    show(i);
  }, 8000);
})();

/* ===========================
   LISTA DE CONSULTORES
=========================== */
const consultores = [
  { nome: "P.M√°rcio", valor: 2, imagem: "https://i.ibb.co/B5wwzSHD/Imagem-do-Whats-App-de-2025-10-31-s-12-44-22-8316baa5.jpg", estrelas: 5 },
  { nome: "Flora", valor: 1, imagem: "https://www.mestresmisticos.com.br/Assets/Imagens/2025/11/06//5dfb048cce-1-_3.webp", estrelas: 5, novo: true },
  { nome: "Carina", valor: 1, imagem: "https://www.mestresmisticos.com.br/Assets/Imagens/2025/12/04//5aea31bd77-1-_3.webp", estrelas: 5, novo: true },
  { nome: "Dalila", valor: 1, imagem: "https://www.mestresmisticos.com.br/Assets/Imagens/2025/10/11//0b284c7b42-1-_3.webp", estrelas: 5, novo: true },
  { nome: "Adria", valor: 1, imagem: "https://www.mestresmisticos.com.br/Assets/Imagens/2025/07/25//d6152621b2-1-_3.webp", estrelas: 5, novo: true },
  { nome: "Thabata", valor: 1, imagem: "https://www.mestresmisticos.com.br/Assets/Imagens/2025/06/28//d5969655ef-1-_3.webp", estrelas: 5, novo: true },
  { nome: "Analu", valor: 1, imagem: "https://www.mestresmisticos.com.br/Assets/Imagens/2025/12/19//fe3f4b6a8a-1-_3.webp", estrelas: 5, novo: true },
  { nome: "Benedita", valor: 1, imagem: "https://www.mestresmisticos.com.br/Assets/Imagens/2025/10/23//9f9ffa4ba9-1-_3.webp", estrelas: 5, novo: true },
  { nome: "Estrela", valor: 1, imagem: "https://www.mestresmisticos.com.br/Assets/Imagens/2026/01/01//b2a24fc4f7-1-_3.webp", estrelas: 5, novo: true },
  { nome: "Sulamita", valor: 1, imagem: "https://www.rainhasdotarot.com.br/Assets/Imagens/2024/05/27//47a447851c-1-.jpg", estrelas: 5 },
  { nome: "Esmeralda", valor: 1, imagem: "https://www.rainhasdotarot.com.br/Assets/Imagens/2020/05/18//41c4696d05-1-.jpg", estrelas: 5 },
  { nome: "M.Padilha", valor: 1, imagem: "https://www.rainhasdotarot.com.br/Assets/Imagens/2025/01/27//699974ac8a-1-.jpg", estrelas: 4 },
  { nome: "Sara", valor: 1, imagem: "https://www.rainhasdotarot.com.br/Assets/Imagens/2024/09/04//9a6f4cec30-1-.jpg", estrelas: 5 },
  { nome: "7 Saias", valor: 1, imagem: "https://www.rainhasdotarot.com.br/Assets/Imagens/2024/02/29//e43513a707-1-.jpg", estrelas: 5 },
  { nome: "Odara", valor: 1, imagem: "https://www.rainhasdotarot.com.br/Assets/Imagens/2024/01/15//91bb2a4455-1-.jpg", estrelas: 5 },
  { nome: "Luara", valor: 1, imagem: "https://www.rainhasdotarot.com.br/Assets/Imagens/2024/08/24//dc4e2cb494-1-.jpg", estrelas: 5 }
];

const container = document.getElementById('cards-container');

consultores.forEach((c, idx) => {
  const card = document.createElement('div');
  card.className = 'card' + (c.novo ? ' novo' : '');
  card.dataset.idx = String(idx);

  card.innerHTML = `
    <div class="img-wrap">
      <img src="${c.imagem}" alt="${c.nome}">
    </div>
    <span class="badge">Online</span>
    <div class="content">
      <div class="name">${c.nome} <span class="dot"></span></div>
      <div class="stars">${'‚òÖ'.repeat(c.estrelas)}${'‚òÜ'.repeat(5 - c.estrelas)}</div>
      <div class="price"><b>R$ ${Number(c.valor).toFixed(2)} por minuto</b></div>
      <a href="#" class="btn disponivel">INICIAR CONSULTA</a>
    </div>
  `;

  card.querySelector('.btn').addEventListener('click', (e) => {
    e.preventDefault();
    if (card.dataset.status !== "online") return;

    localStorage.clear();
    localStorage.setItem('consultorNome', c.nome);
    localStorage.setItem('consultorValor', c.valor);
    localStorage.setItem('consultorImagem', c.imagem);

    window.location.href = 'https://marcio2307.github.io/cartomantesonline.site/pacotes.html';
  });

  container.appendChild(card);
});

/* ===========================
   ‚úÖ REGRAS MAIS REAIS (ONLINE / OCUPADO / INDISPON√çVEL)
=========================== */
const chance = (p) => Math.random() < p;

const STORAGE_KEY = "status_realista_v3";
let estado = null;

function carregarEstado(){
  try{
    const raw = sessionStorage.getItem(STORAGE_KEY);
    if(!raw) return null;
    const parsed = JSON.parse(raw);
    if(!parsed || !Array.isArray(parsed.consultores)) return null;
    return parsed;
  }catch{ return null; }
}
function salvarEstado(){
  try{ sessionStorage.setItem(STORAGE_KEY, JSON.stringify(estado)); }catch{}
}

function setStatusDOM(card, status){
  const badge = card.querySelector('.badge');
  const dot = card.querySelector('.dot');
  const btn = card.querySelector('.btn');

  card.dataset.status = status;

  badge.classList.remove('ocupado','indisp');
  dot.classList.remove('ocupado','indisp');
  btn.classList.remove('ocupado','indisp','disponivel');

  dot.style.animation = '';

  if(status === "online"){
    badge.textContent = 'Online';
    dot.style.animation = 'blink 1s infinite';
    btn.textContent = 'INICIAR CONSULTA';
    btn.classList.add('disponivel');
    btn.style.pointerEvents = '';
  }else if(status === "ocupado"){
    badge.textContent = 'Ocupado';
    badge.classList.add('ocupado');
    dot.classList.add('ocupado');
    dot.style.animation = 'none';
    btn.textContent = 'OCUPADO';
    btn.classList.add('ocupado');
    btn.style.pointerEvents = 'none';
  }else{
    badge.textContent = 'Indispon√≠vel';
    badge.classList.add('indisp');
    dot.classList.add('indisp');
    dot.style.animation = 'none';
    btn.textContent = 'INDISPON√çVEL';
    btn.classList.add('indisp');
    btn.style.pointerEvents = 'none';
  }
}

function todosIndisponiveisAgora(){
  const h = new Date().getHours();
  return (h >= 2 && h < 10);
}

function initEstado(){
  const dia = new Date().toDateString();
  const anterior = carregarEstado();

  if(anterior && anterior.dia === dia && anterior.consultores?.length === consultores.length){
    estado = anterior;
    return;
  }

  estado = {
    dia,
    consultores: consultores.map(() => ({
      status: "online",
      holdUntil: 0
    }))
  };

  aplicarStatusRealista(true);
  salvarEstado();
}

function escolherIndisponiveis(cards){
  const total = cards.length;
  const qtd = chance(0.55) ? 1 : 2;

  const indices = [...Array(total)].map((_,i)=>i);
  for(let i=indices.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [indices[i], indices[j]] = [indices[j], indices[i]];
  }
  return new Set(indices.slice(0, Math.min(qtd, total)));
}

function aplicarStatusRealista(forceAll=false){
  const now = Date.now();
  const hora = new Date().getHours();
  const cards = Array.from(document.querySelectorAll('.card'));

  if(todosIndisponiveisAgora()){
    cards.forEach((card, i) => {
      const st = estado.consultores[i];
      st.status = "indisp";
      st.holdUntil = now + 60 * 1000;
      setStatusDOM(card, "indisp");
    });
    salvarEstado();
    return;
  }

  let ocupProb = 0.40;
  if (hora >= 9 && hora < 12) ocupProb = 0.34;
  if (hora >= 12 && hora < 17) ocupProb = 0.44;
  if (hora >= 17 && hora < 22) ocupProb = 0.56;
  if (hora >= 22 || hora < 6) ocupProb = 0.38;

  const indispSet = escolherIndisponiveis(cards);

  cards.forEach((card, i) => {
    const st = estado.consultores[i];

    const emHold = !forceAll && st.holdUntil && now < st.holdUntil;
    if (emHold){
      setStatusDOM(card, st.status);
      return;
    }

    if (indispSet.has(i)){
      st.status = "indisp";
      st.holdUntil = now + Math.floor((2 + Math.random()*3) * 60 * 1000);
      setStatusDOM(card, "indisp");
      return;
    }

    const novoStatus = chance(ocupProb) ? "ocupado" : "online";
    st.status = novoStatus;

    st.holdUntil = (novoStatus === "ocupado")
      ? now + Math.floor((2 + Math.random()*4) * 60 * 1000)
      : now + Math.floor((1 + Math.random()*2) * 60 * 1000);

    setStatusDOM(card, novoStatus);
  });

  salvarEstado();
}

initEstado();
aplicarStatusRealista(false);
setInterval(() => aplicarStatusRealista(false), 20000);

document.addEventListener('visibilitychange', () => {
  if (!document.hidden) aplicarStatusRealista(false);
});

/* ==========================================================
   ‚úÖ PUSH / NOTIFICA√á√ïES (AJUSTADO PARA O ENVIO-7 + GITHUB PAGES)
========================================================== */

const PUSH_SERVER = "https://envio-7.onrender.com";

const notifBar = document.getElementById("notifBar");
const notifBtn = document.getElementById("notifBtn");
const notifClose = document.getElementById("notifClose");
const notifStatus = document.getElementById("notifStatus");

function showNotifBar(msg){
  notifBar.style.display = "block";
  notifStatus.textContent = msg || "";
}
function hideNotifBar(){
  notifBar.style.display = "none";
  notifStatus.textContent = "";
}

function detectScopeBase(){
  // github.io -> "/NOME-REPO/"
  const parts = location.pathname.split("/").filter(Boolean);
  if (location.hostname.endsWith("github.io") && parts.length > 0) return `/${parts[0]}/`;
  // dom√≠nio pr√≥prio -> raiz
  return "/";
}

const SCOPE_BASE = detectScopeBase();
const SW_URL = `${SCOPE_BASE}service-worker.js`;

function urlBase64ToUint8Array(base64String){
  const padding = "=".repeat((4 - base64String.length % 4) % 4);
  const base64 = (base64String + padding).replace(/-/g, "+").replace(/_/g, "/");
  const rawData = atob(base64);
  const outputArray = new Uint8Array(rawData.length);
  for (let i = 0; i < rawData.length; i++) outputArray[i] = rawData.charCodeAt(i);
  return outputArray;
}

async function ensureServiceWorker(){
  if (!("serviceWorker" in navigator)) throw new Error("Service Worker n√£o suportado.");
  if (!isSecureContext) throw new Error("Push s√≥ funciona em HTTPS.");

  const reg = await navigator.serviceWorker.register(SW_URL, { scope: SCOPE_BASE });
  await navigator.serviceWorker.ready;

  // for√ßa update do SW (quando voc√™ muda o arquivo)
  try { await reg.update(); } catch {}

  return reg;
}

let VAPID_PUBLIC_KEY = "";

async function getVapidFromServer(){
  const res = await fetch(PUSH_SERVER.replace(/\/+$/,"") + "/vapid-public-key", { cache:"no-store" });
  const text = await res.text();
  let data = null;
  try { data = JSON.parse(text); } catch {}
  if (!res.ok || !data?.publicKey) throw new Error("Falha ao pegar VAPID do servidor: " + text);
  VAPID_PUBLIC_KEY = data.publicKey;
}

async function saveSubscriptionToServer(subscription){
  const subJson = (typeof subscription?.toJSON === "function") ? subscription.toJSON() : subscription;

  const res = await fetch(PUSH_SERVER.replace(/\/+$/,"") + "/save-subscription", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(subJson)
  });

  const text = await res.text();
  if (!res.ok) throw new Error(`Falha ao salvar inscri√ß√£o (HTTP ${res.status}): ${text}`);
}

async function subscribeOrResave(force=false){
  const reg = await navigator.serviceWorker.ready;
  let sub = await reg.pushManager.getSubscription();

  if (force && sub){
    try { await sub.unsubscribe(); } catch {}
    sub = null;
  }

  if (sub){
    await saveSubscriptionToServer(sub);
    return sub;
  }

  if (!VAPID_PUBLIC_KEY) throw new Error("VAPID_PUBLIC_KEY vazia.");

  sub = await reg.pushManager.subscribe({
    userVisibleOnly: true,
    applicationServerKey: urlBase64ToUint8Array(VAPID_PUBLIC_KEY)
  });

  await saveSubscriptionToServer(sub);
  return sub;
}

function shouldShowPrompt(){
  if (!("Notification" in window)) return false;
  const perm = Notification.permission;
  if (perm === "granted") return false;
  return true;
}

async function initPushUI(){
  try {
    await ensureServiceWorker();
    await getVapidFromServer();
  } catch (e) {
    // se falhar aqui, n√£o trava a p√°gina ‚Äî s√≥ n√£o mostra o popup
    return;
  }

  if (shouldShowPrompt()){
    if (Notification.permission === "denied"){
      showNotifBar("‚ö†Ô∏è Notifica√ß√µes bloqueadas.\nLibere nas configura√ß√µes do navegador para este site.");
    } else {
      showNotifBar("");
    }
  } else {
    hideNotifBar();
    // se j√° est√° granted, recadastra silenciosamente
    try { await subscribeOrResave(false); } catch {}
  }
}

notifClose.addEventListener("click", () => hideNotifBar());

notifBtn.addEventListener("click", async () => {
  try{
    notifStatus.textContent = "Processando...";

    await ensureServiceWorker();
    await getVapidFromServer();

    if (!("Notification" in window)) throw new Error("Notifica√ß√µes n√£o suportadas.");

    const perm = await Notification.requestPermission();
    if (perm !== "granted"){
      showNotifBar("‚ö†Ô∏è Permiss√£o n√£o concedida.\nSe bloqueou, libere nas configura√ß√µes.");
      return;
    }

    notifStatus.textContent = "Cadastrando no servidor...";
    await subscribeOrResave(true); // for√ßa recadastro no clique

    hideNotifBar();
  }catch(e){
    showNotifBar("‚ùå Erro ao ativar.\n" + (e?.message || e));
  }
});

initPushUI();
</script>

</body>
</html>
